import streamlit as st
import pandas as pd
from datetime import datetime

# --- åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®šï¼ˆæœ¬æ¥ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ç®¡ç†ï¼‰ ---
if 'fleet_data' not in st.session_state:
    st.session_state.fleet_data = pd.DataFrame([
        {"ä¼šç¤¾å": "è­¦å‚™Aç¤¾", "ç©ºãäººæ•°": 5, "æ›´æ–°æ™‚é–“": "2026-01-16 10:00"},
        {"ä¼šç¤¾å": "è­¦å‚™Bç¤¾", "ç©ºãäººæ•°": 0, "æ›´æ–°æ™‚é–“": "2026-01-16 11:30"},
    ])

st.title("ğŸ›¡ï¸ è­¦å‚™éšŠå“¡ãƒ»å…±åŒå¿œæ´ãƒãƒƒãƒãƒ³ã‚°")
st.caption("ææºæ¥­è€…é–“ã§ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éœ€çµ¦èª¿æ•´ã‚·ã‚¹ãƒ†ãƒ ")

# --- 1. è‡ªç¤¾ã®çŠ¶æ³ã‚’æ›´æ–°ã™ã‚‹ï¼ˆä¾›çµ¦å´ï¼‰ ---
with st.expander("â• è‡ªç¤¾ã®ç©ºãçŠ¶æ³ã‚’ç™»éŒ²ãƒ»æ›´æ–°ã™ã‚‹"):
    with st.form("update_form"):
        company_name = st.selectbox("è‡ªç¤¾åã‚’é¸æŠ", ["è­¦å‚™Aç¤¾", "è­¦å‚™Bç¤¾", "è­¦å‚™Cç¤¾", "è­¦å‚™Dç¤¾"])
        available_count = st.number_input("å¿œæ´ã«å‡ºã›ã‚‹äººæ•°", min_value=0, step=1)
        submit_btn = st.form_submit_button("æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹")
        
        if submit_btn:
            now = datetime.now().strftime("%Y-%m-%d %H:%M")
            # æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
            if company_name in st.session_state.fleet_data["ä¼šç¤¾å"].values:
                st.session_state.fleet_data.loc[st.session_state.fleet_data["ä¼šç¤¾å"] == company_name, ["ç©ºãäººæ•°", "æ›´æ–°æ™‚é–“"]] = [available_count, now]
            else:
                # æ–°è¦ç™»éŒ²
                new_data = {"ä¼šç¤¾å": company_name, "ç©ºãäººæ•°": available_count, "æ›´æ–°æ™‚é–“": now}
                st.session_state.fleet_data = pd.concat([st.session_state.fleet_data, pd.DataFrame([new_data])], ignore_index=True)
            st.success(f"{company_name}ã®æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼")

---

# --- 2. ç©ºãçŠ¶æ³ä¸€è¦§ï¼ˆéœ€è¦å´ï¼‰ ---
st.subheader("ğŸŒ ç¾åœ¨ã®å¿œæ´å¯èƒ½ãƒªã‚¹ãƒˆ")
# äººæ•°ãŒ1äººä»¥ä¸Šã®ä¼šç¤¾ã®ã¿è¡¨ç¤º
available_list = st.session_state.fleet_data[st.session_state.fleet_data["ç©ºãäººæ•°"] > 0]

if not available_list.empty:
    st.table(available_list)
    
    # ä»®äºˆç´„æ©Ÿèƒ½
    target_company = st.selectbox("å¿œæ´ã‚’ä¾é ¼ã—ãŸã„ä¼šç¤¾ã‚’é¸æŠ", available_list["ä¼šç¤¾å"])
    request_num = st.number_input("ä¾é ¼ã—ãŸã„äººæ•°", min_value=1, step=1)
    
    if st.button("ä»®äºˆç´„ï¼ˆãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥é€ä¿¡ï¼‰"):
        # ã“ã“ã§æœ¬æ¥ã¯LINEã‚„ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥ã‚’é£›ã°ã™
        st.warning(f"ã€ä»®äºˆç´„å®Ÿè¡Œã€‘{target_company}ã¸{request_num}åã®å¿œæ´ä¾é ¼ã‚’é€ã‚Šã¾ã—ãŸã€‚ç›¸æ‰‹æ–¹ã®æ‰¿è«¾ã‚’å¾…ã£ã¦ãã ã•ã„ã€‚")
else:
    st.info("ç¾åœ¨ã€å¿œæ´å¯èƒ½ãªä¼šç¤¾ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚")